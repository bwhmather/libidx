language: c
script:
  - make test
env: CFLAGS=-Werror
compiler:
  - clang
  - gcc

jobs:
  include:
    - stage: coverage
      addons:
        apt:
          sources:
            - ubuntu-toolchain-r-test
          packages:
            - gcc-7
      install:
        - pip install --user cpp-coveralls
      script:
        - make test
      after_success:
        - coveralls -i src/idx.c --gcov-options '\-lpo build/lib'
      env:
        - CC=gcc-7
        - DEBUG=1
        - COVERAGE=1
